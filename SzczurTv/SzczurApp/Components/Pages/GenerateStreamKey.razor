@page "/generate-stream-key"
@rendermode InteractiveServer

@inject StreamingService StreamingService
@inject UserManager<ApplicationUser> UserManager
@inject AuthenticationStateProvider AuthenticationStateProvider

<h3>Generate Stream Key</h3>

@if (!string.IsNullOrEmpty(StreamKey))
{
    <p>Your stream key: @StreamKey</p>
    <p>Stream URL: @StreamUrl</p>
}
else
{
    <button @onclick="GenerateKey">Generate Stream Key</button>
}

@code {
    private string? StreamKey;
    private string? StreamUrl;

    private async Task GenerateKey()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = await UserManager.GetUserAsync(authState.User);
        if (user != null)
        {
            StreamKey = await StreamingService.GenerateStreamKeyAsync(user.Id);
            StreamUrl = await StreamingService.GetStreamUrlAsync(user.Id);
        }
    }
}
